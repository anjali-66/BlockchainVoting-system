{"ast":null,"code":"\"use client\";\n\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { webLocalStorage } from \"../../../../utils/storage/webStorage.js\";\nimport { isEcosystemWallet } from \"../../../../wallets/ecosystem/is-ecosystem-wallet.js\";\nimport { setLastAuthProvider } from \"../../../core/utils/storage.js\";\nimport { Spacer } from \"../../ui/components/Spacer.js\";\nimport { Spinner } from \"../../ui/components/Spinner.js\";\nimport { Container, ModalHeader } from \"../../ui/components/basic.js\";\nimport { Button } from \"../../ui/components/buttons.js\";\nimport { Text } from \"../../ui/components/text.js\";\n/**\n * @internal\n */\nexport function GuestLogin(props) {\n  const ewLocale = props.locale;\n  const locale = ewLocale.socialLoginScreen;\n  const [authError, setAuthError] = useState(undefined);\n  const {\n    done,\n    wallet\n  } = props;\n  const [status, setStatus] = useState(\"connecting\");\n  const handleGuestLogin = async () => {\n    const connectOptions = {\n      client: props.client,\n      ecosystem: isEcosystemWallet(wallet) ? {\n        id: wallet.id,\n        partnerId: wallet.getConfig()?.partnerId\n      } : undefined,\n      strategy: \"guest\"\n    };\n    try {\n      await wallet.connect(connectOptions);\n      await setLastAuthProvider(\"guest\", webLocalStorage);\n      setStatus(\"connected\");\n      done();\n    } catch (e) {\n      setStatus(\"error\");\n      // TODO this only happens on 'retry' button click, not on initial login\n      // should pass auth error message to this component\n      if (e instanceof Error && e?.message?.includes(\"PAYMENT_METHOD_REQUIRED\")) {\n        setAuthError(ewLocale.maxAccountsExceeded);\n      }\n      console.error(\"Error generating guest account\", e);\n    }\n  };\n  const guestLogin = props.state?.guestLogin;\n  const socialLoginStarted = useRef(false);\n  useEffect(() => {\n    if (socialLoginStarted.current) {\n      return;\n    }\n    if (guestLogin) {\n      socialLoginStarted.current = true;\n      setStatus(\"connecting\");\n      guestLogin.connectionPromise.then(() => {\n        done();\n        setStatus(\"connected\");\n      }).catch(e => {\n        setAuthError(e.message);\n        setStatus(\"error\");\n      });\n    }\n  }, [done, guestLogin]);\n  return _jsx(Container, {\n    animate: \"fadein\",\n    flex: \"column\",\n    fullHeight: true,\n    children: _jsxs(Container, {\n      flex: \"column\",\n      expand: true,\n      p: \"lg\",\n      style: {\n        paddingBottom: 0\n      },\n      children: [props.goBack && _jsx(ModalHeader, {\n        title: locale.title,\n        onBack: props.goBack\n      }), props.size === \"compact\" ? _jsx(Spacer, {\n        y: \"xl\"\n      }) : null, _jsxs(Container, {\n        flex: \"column\",\n        center: \"both\",\n        expand: true,\n        style: {\n          textAlign: \"center\",\n          minHeight: \"250px\"\n        },\n        children: [status !== \"error\" && _jsxs(Container, {\n          animate: \"fadein\",\n          children: [_jsx(Text, {\n            color: \"primaryText\",\n            center: true,\n            multiline: true,\n            style: {\n              maxWidth: \"250px\"\n            },\n            children: \"Generating your guest account\"\n          }), _jsx(Spacer, {\n            y: \"xl\"\n          }), _jsx(Container, {\n            center: \"x\",\n            flex: \"row\",\n            children: _jsx(Spinner, {\n              size: \"lg\",\n              color: \"accentText\"\n            })\n          }), _jsx(Spacer, {\n            y: \"xxl\"\n          })]\n        }), status === \"error\" && _jsxs(Container, {\n          animate: \"fadein\",\n          children: [authError ? _jsx(Text, {\n            center: true,\n            color: \"danger\",\n            children: authError\n          }) : _jsx(Text, {\n            color: \"danger\",\n            children: locale.failed\n          }), _jsx(Spacer, {\n            y: \"lg\"\n          }), _jsx(Button, {\n            variant: \"primary\",\n            onClick: handleGuestLogin,\n            children: locale.retry\n          }), _jsx(Spacer, {\n            y: \"xxl\"\n          })]\n        })]\n      })]\n    })\n  });\n}\n//# sourceMappingURL=GuestLogin.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}